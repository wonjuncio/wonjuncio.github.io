---
layout: default
---

{% include lang.html %}

<div class="posts-page">
  <!-- ================================ -->
  <!-- 1. Title -->
  <!-- ================================ -->
  <h1 class="posts-title">Posts</h1>
  
  <!-- ================================ -->
  <!-- 2. Primary Control - Search -->
  <!-- ================================ -->
  <div class="posts-search-wrapper">
    <i class="fas fa-search"></i>
    <input type="text" id="posts-search" placeholder="Search posts...">
  </div>

  <!-- ================================ -->
  <!-- 3. Secondary Control - Category Filter (Primary Categories Only) -->
  <!-- ================================ -->
  {% comment %} Extract unique primary categories from all posts {% endcomment %}
  {% assign primary_cats = "" | split: "" %}
  {% for post in site.posts %}
    {% if post.hidden != true and post.categories.size > 0 %}
      {% assign first_cat = post.categories | first %}
      {% assign primary_cats = primary_cats | push: first_cat %}
    {% endif %}
  {% endfor %}
  {% assign primary_cats = primary_cats | uniq | sort %}
  
  <div class="posts-category-filter">
    <div class="category-list" id="category-list">
      <button class="category-item active" data-category="all">All</button>
      {% assign cat_count = 0 %}
      {% for category in primary_cats %}
        {% assign cat_count = cat_count | plus: 1 %}
        <button class="category-item{% if cat_count > 5 %} hidden-category{% endif %}" data-category="{{ category | downcase }}">
          {{ category }}
        </button>
      {% endfor %}
    </div>
    {% if primary_cats.size > 5 %}
      <button class="category-more" id="category-more-btn">
        More <i class="fas fa-chevron-down"></i>
      </button>
    {% endif %}
  </div>

  <!-- ================================ -->
  <!-- 4. Content - Post List -->
  <!-- ================================ -->
  <div class="posts-list" id="posts-list">
    {% assign visible_posts = site.posts | where_exp: 'post', 'post.hidden != true' %}
    {% for post in visible_posts %}
      <a href="{{ post.url | relative_url }}" class="posts-card" 
         data-title="{{ post.title | downcase }}"
         data-primary-category="{{ post.categories | first | downcase }}"
         data-tags="{% for tag in post.tags %}{{ tag | downcase }} {% endfor %}">
        <div class="posts-card-header">
          <h3 class="posts-card-title">{{ post.title }}</h3>
          <span class="posts-card-date">{{ post.date | date: "%b %d, %Y" }}</span>
        </div>
        
        <p class="posts-card-excerpt">
          {{ post.excerpt | strip_html | truncate: 150 }}
        </p>
        
        <div class="posts-card-meta">
          {% for category in post.categories %}
            <span class="posts-card-category">{{ category }}</span>
          {% endfor %}
          {% for tag in post.tags limit: 3 %}
            <span class="posts-card-tag">{{ tag }}</span>
          {% endfor %}
        </div>
      </a>
    {% endfor %}
  </div>

  <!-- ================================ -->
  <!-- 5. Pagination -->
  <!-- ================================ -->
  <div class="posts-pagination" id="posts-pagination"></div>

  <!-- ================================ -->
  <!-- Archive (Collapsed) -->
  <!-- ================================ -->
  <div class="posts-archive">
    <div class="section-header">
      <h2>Archive</h2>
    </div>
    
    {% assign posts_by_year = visible_posts | group_by_exp: "post", "post.date | date: '%Y'" %}
    {% for year in posts_by_year %}
      <div class="archive-year">
        <div class="archive-year-header collapsed" data-year="{{ year.name }}">
          <h3>{{ year.name }}</h3>
          <span>({{ year.items | size }} posts)</span>
          <i class="fas fa-chevron-down"></i>
        </div>
        <div class="archive-year-list collapsed" id="archive-{{ year.name }}">
          {% for post in year.items %}
            <a href="{{ post.url | relative_url }}" class="archive-item">
              <span class="archive-item-date">{{ post.date | date: "%m-%d" }}</span>
              <span class="archive-item-title">{{ post.title }}</span>
            </a>
          {% endfor %}
        </div>
      </div>
    {% endfor %}
  </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const searchInput = document.getElementById('posts-search');
  const postsCards = document.querySelectorAll('.posts-card');
  const paginationContainer = document.getElementById('posts-pagination');
  const categoryMoreBtn = document.getElementById('category-more-btn');
  const hiddenCategories = document.querySelectorAll('.hidden-category');
  
  const PER_PAGE = 10;
  let currentPage = 1;
  let filteredCards = Array.from(postsCards);
  let categoriesExpanded = false;
  
  // Category More toggle
  if (categoryMoreBtn) {
    categoryMoreBtn.addEventListener('click', function() {
      categoriesExpanded = !categoriesExpanded;
      hiddenCategories.forEach(cat => {
        cat.classList.toggle('hidden-category', !categoriesExpanded);
      });
      this.innerHTML = categoriesExpanded 
        ? 'Less <i class="fas fa-chevron-up"></i>' 
        : 'More <i class="fas fa-chevron-down"></i>';
    });
  }
  
  // Render pagination
  function renderPagination() {
    const totalPages = Math.ceil(filteredCards.length / PER_PAGE);
    
    if (totalPages <= 1) {
      paginationContainer.innerHTML = '';
      return;
    }
    
    let html = '<div class="pagination-inner">';
    
    // Prev button
    if (currentPage > 1) {
      html += `<button class="page-nav" data-page="${currentPage - 1}">← Prev</button>`;
    } else {
      html += `<span class="page-nav disabled">← Prev</span>`;
    }
    
    // Page numbers
    const maxVisible = 5;
    let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
    let endPage = Math.min(totalPages, startPage + maxVisible - 1);
    
    if (endPage - startPage < maxVisible - 1) {
      startPage = Math.max(1, endPage - maxVisible + 1);
    }
    
    if (startPage > 1) {
      html += `<button class="page-num" data-page="1">1</button>`;
      if (startPage > 2) {
        html += `<span class="page-ellipsis">…</span>`;
      }
    }
    
    for (let i = startPage; i <= endPage; i++) {
      if (i === currentPage) {
        html += `<span class="page-num current">${i}</span>`;
      } else {
        html += `<button class="page-num" data-page="${i}">${i}</button>`;
      }
    }
    
    if (endPage < totalPages) {
      if (endPage < totalPages - 1) {
        html += `<span class="page-ellipsis">…</span>`;
      }
      html += `<button class="page-num" data-page="${totalPages}">${totalPages}</button>`;
    }
    
    // Next button
    if (currentPage < totalPages) {
      html += `<button class="page-nav" data-page="${currentPage + 1}">Next →</button>`;
    } else {
      html += `<span class="page-nav disabled">Next →</span>`;
    }
    
    html += '</div>';
    paginationContainer.innerHTML = html;
    
    // Add event listeners
    paginationContainer.querySelectorAll('button[data-page]').forEach(btn => {
      btn.addEventListener('click', function() {
        currentPage = parseInt(this.dataset.page);
        updateDisplay();
        window.scrollTo({ top: 0, behavior: 'smooth' });
      });
    });
  }
  
  // Update display
  function updateDisplay() {
    const start = (currentPage - 1) * PER_PAGE;
    const end = start + PER_PAGE;
    
    postsCards.forEach(card => card.style.display = 'none');
    filteredCards.slice(start, end).forEach(card => card.style.display = 'block');
    
    renderPagination();
  }
  
  // Filter posts
  function filterPosts() {
    const query = searchInput.value.toLowerCase().trim();
    const activeCategory = document.querySelector('.category-item.active')?.dataset.category || 'all';
    
    filteredCards = Array.from(postsCards).filter(card => {
      const title = card.dataset.title || '';
      const primaryCategory = card.dataset.primaryCategory || '';
      const tags = card.dataset.tags || '';
      
      const matchesSearch = !query || 
        title.includes(query) || 
        primaryCategory.includes(query) || 
        tags.includes(query);
      
      const matchesCategory = activeCategory === 'all' || primaryCategory === activeCategory;
      
      return matchesSearch && matchesCategory;
    });
    
    currentPage = 1;
    updateDisplay();
  }
  
  // Search
  searchInput.addEventListener('input', filterPosts);
  
  // Category filter
  const categoryItems = document.querySelectorAll('.category-item');
  categoryItems.forEach(item => {
    item.addEventListener('click', function() {
      categoryItems.forEach(i => i.classList.remove('active'));
      this.classList.add('active');
      filterPosts();
    });
  });
  
  // Archive toggle
  const archiveHeaders = document.querySelectorAll('.archive-year-header');
  archiveHeaders.forEach(header => {
    header.addEventListener('click', function() {
      const year = this.dataset.year;
      const list = document.getElementById('archive-' + year);
      this.classList.toggle('collapsed');
      list.classList.toggle('collapsed');
    });
  });
  
  // Initial display
  updateDisplay();
});
</script>
